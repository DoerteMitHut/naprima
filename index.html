<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NaPrimA: The &lt;tt&gt;naprima&lt;/tt&gt; Package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NaPrimA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The <code>naprima</code> Package </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a>The <code>naprima</code> package is the result of a master's thesis project and was used to faciliate the evaluation of a mathematical model of arm movement assembly from movement primitives. Its structure suggests an interface against which modules for the kinematic modeling of robots, control interfaces for the operation of robots or robot simulations, perception modules and modules for the planning of movements can be developed and added to a the existing ones to provide a library for the modular design and execution of robotics experiments.</p>
<p>If you have any suggestions, feel free to use the issue tracker.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
An Example Experiment</h1>
<p>In the following, the use of the full application scope of the <code>naprima</code> package will be illustrated by setting up an example.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Generating Movements from Movement Primitives</h2>
<p>We start by defining the transport primitive </p><div class="fragment"><div class="line">def transport(t,task): </div>
<div class="line">    # extract needed information from task</div>
<div class="line">    tau = task[&quot;tau&quot;]</div>
<div class="line">    p_target = cartesian(task[&quot;p_target&quot;])</div>
<div class="line">    p_0 = cartesian(task[&quot;p_0&quot;])</div>
<div class="line">    </div>
<div class="line">    # compute linear component of primitive</div>
<div class="line">    n = p_target-p_0</div>
<div class="line">    norm_n = np.linalg.norm(n)</div>
<div class="line">    n_hat = n/norm_n</div>
<div class="line">    P_lin = n_hat*norm_n*(1-np.cos(2*t*np.pi/tau))/tau</div>
<div class="line">    </div>
<div class="line">    # assemble SE(3) matrix from P_lin</div>
<div class="line">    return RpToTrans(np.eye(3),P_lin.T)</div>
<div class="line">    #Note: RpToTrans is a function from the modern_robotics package</div>
</div><!-- fragment --><p> In the python file <code>main.py</code> we will be executing, we can now import the transport primitive as a function: </p><div class="fragment"><div class="line">from naprima.primitives import transport</div>
</div><!-- fragment --><p> In order to call the primitive, we need to define a task to supply it with the required information about the environment. A task is defined as a python dictionary in <code>main.py</code> as follows:</p>
<div class="fragment"><div class="line"># importing primitives</div>
<div class="line">from naprima.primitives import transport</div>
<div class="line"> </div>
<div class="line"># defining initial positions of target and eef</div>
<div class="line">p_target = [0,1,0.2]</div>
<div class="line">p_0 = [0,0.5,0.2]</div>
<div class="line"> </div>
<div class="line"># defining a task as a dictionary</div>
<div class="line">task = {</div>
<div class="line">    &quot;tau&quot; : 1.5,</div>
<div class="line">    &quot;p_target&quot;: p_target,</div>
<div class="line">    &quot;p_0&quot;: p_0</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># calling the primitive at instant 0.1</div>
<div class="line">transport(0.1,task)</div>
<div class="line"> </div>
<div class="line"># producing a time series of the primitive&#39;s value</div>
<div class="line">from numpy import linspace</div>
<div class="line">values = [transport(t,task) for t in linspace(0,1.5,100)]</div>
</div><!-- fragment --><p> If we import a second primitive <code>vertical_lift</code> from <code>naprima.primitives</code>, which requires an amplitude parameter from the task, we can now import the movement strategy class to assemble both primitives into a movement strategy as follows:</p>
<div class="fragment"><div class="line"># importing primitives</div>
<div class="line">from naprima.primitives import transport, vertical_lift</div>
<div class="line"># importing Movement Strategy</div>
<div class="line">from naprima.strategies import MovementStrategy</div>
<div class="line"> </div>
<div class="line"># defining initial positions of target and eef</div>
<div class="line">p_target = [0,1,0.2]</div>
<div class="line">p_0 = [0,0.5,0.2]</div>
<div class="line"> </div>
<div class="line"># adding lift_amplitude to the task</div>
<div class="line">task = {</div>
<div class="line">    &quot;tau&quot; : 1.5,</div>
<div class="line">    &quot;p_target&quot;: p_target,</div>
<div class="line">    &quot;p_0&quot;: p_0</div>
<div class="line">    &quot;lift_amplitude&quot;: 0.3</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># instantiating a strategy to apply transport and lift to the task </div>
<div class="line">strategy = MovementStrategy(task,[transport,vertical_lift])</div>
<div class="line"> </div>
<div class="line"># obtaining movement at instant t as SE(3)-matrix from strategy </div>
<div class="line">strategy.get_movement(t,&quot;SE(3)&quot;)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3"></a>
Kinematics</h2>
<p>To deploy the movements that result from a strategy to a kinematic model of a kinematic chain, we import the <code>KinematicChain</code> class from <code>naprima.robotics</code> and define a kinematic chain by providing the axes of rotation for its joints, the positions of said joints in the chosen home position and the SE(3)-matrix to transform the base frame {B} into the tool frame {T} when the robot is in its home position.</p>
<p>For illustration purposes I will use a 2R(meaning two revolute joints)-robot.</p>
<div class="fragment"><div class="line"># importing primitives</div>
<div class="line">from naprima.primitives import transport, vertical_lift</div>
<div class="line">from naprima.strategies import MovementStrategy</div>
<div class="line">from naprima.robotics import KinematicChain</div>
<div class="line"> </div>
<div class="line"># import numpy for matrix operations and array class</div>
<div class="line">import numpy as np</div>
<div class="line"> </div>
<div class="line"># defining rotation axes of joints</div>
<div class="line">joint_axes = [[   0,  1,  0],[   0,  1, 0]]</div>
<div class="line">joint_positions = [[0,0,0],[0,0,0.5]]</div>
<div class="line">tool_frame = np.array([[1,0,0,0],</div>
<div class="line">                       [0,1,0,0],</div>
<div class="line">                       [0,0,1,1.0],</div>
<div class="line">                       [0,0,0,1]])</div>
<div class="line"> </div>
<div class="line">robot = KinematicChain(joint_axes,joint_positions,tool_frame)</div>
<div class="line">                       </div>
<div class="line"># defining initial positions of target and eef</div>
<div class="line">p_target = [0,1,0.2]</div>
<div class="line"># get initial eef position from the forward kinematic with thetas = (0,0)</div>
<div class="line">current_theta = [0,0]</div>
<div class="line">p_0 = robot.get_fk_position(current_theta)</div>
<div class="line"> </div>
<div class="line"># adding lift_amplitude to the task</div>
<div class="line">task = {</div>
<div class="line">    &quot;tau&quot; : 1.5,</div>
<div class="line">    &quot;p_target&quot;: p_target,</div>
<div class="line">    &quot;p_0&quot;: p_0</div>
<div class="line">    &quot;lift_amplitude&quot;: 0.3</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"># instantiating a strategy to apply transport and lift to the task </div>
<div class="line">strategy = MovementStrategy(task,[transport,vertical_lift])</div>
<div class="line"> </div>
<div class="line"># obtaining the spatial velocity at instant t from movement strategy </div>
<div class="line">twist = strategy.get_movement(t,&quot;TwistVector&quot;)</div>
<div class="line"># obtaining desired joint velocities by leftt multiplying the current Jacobian </div>
<div class="line">inv_Jacobian = robot.get_inverse_Jacobian(current_theta) @ twist</div>
<div class="line"># updating current theta with a 1s-timestep</div>
<div class="line">current_theta = current_theta + theta_dot</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
